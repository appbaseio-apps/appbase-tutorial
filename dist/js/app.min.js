function TutorialService(e){function t(e){null==appbaseRef&&(appbaseRef=new Appbase({url:"https://"+e.user+":"+e.pass+"@scalr.api.appbase.io",appname:e.name}))}this.auth=function(){return e.get(tutorial_adrs+"user")},this.createApp=function(t){return e.put(tutorial_adrs+"app/"+t)},this.step1=function(t){var a="https://scalr.api.appbase.io/"+t.name+"/"+t.type+"/"+t.id,r=JSON.stringify(t.purejson),n=t.user+":"+t.pass;return e({url:a,method:"PUT",headers:{Authorization:"Basic "+btoa(n)},data:r})},this.step2={get:function(e){t(e);var a=appbaseRef.get({type:e.type,id:e.id});return a},stream:function(e){return t(e),responseStream=appbaseRef.getStream({type:e.type,id:e.id}),responseStream}},this.step3={get:function(e){t(e);var a=appbaseRef.search({type:e.type,body:{query:{match_all:{}}}});return a},stream:function(e){return t(e),responseStream=appbaseRef.searchStream({type:e.type,body:{query:{match_all:{}}}}),responseStream}},this.insertData=function(e){t(e.credentials);var a=appbaseRef.index(e.userInput);return a}}function Loader(e,t){return function(a,r,n){e.animated=r,e.animateFlag=n,t(function(){e.loadLine=a})}}function TutorialController(t,a,r,n,i,o){function s(e,a){t.show_response(a,e,!1,!0)}function p(e,a){console.log("streaming error: ",e),t.show_response(a,"You need to insert data first, from index data card.",!0)}appbaseRef=null,t.$watch("activeState",function(e,a){var r=100*t.activeState/t.totalStep;r>t.stepProgress&&(t.stepProgress=r,t.stepCompletion=100==r,i(t.stepProgress,!0,t.stepCompletion))}),t.initialize_var=function(){t.activeState=1,t.current_step=1,t.stepProgress=0,t.totalStep=6,t.languages=["Javascript","cURL"],t.variables={app_name:"",created_app:{name:"$app",user:"$user",pass:"$pass",type:"product",id:"1",jsonobject:$("<div>").addClass("highlight-light").html("<pre><code>{<br>name: 'A green door',<br>price: 12.50,<br>tags: ['home', 'green'],<br>stores: ['Walmart', 'Target']<br>}</code></pre>"),purejson:{name:"A green door",price:12.5,tags:["home","green"],stores:["Walmart","Target"]}}},t.spinner={activeIcon:{container:"btn-success",active:"active",status:{title:"Stream",text:"Stream is waiting for data updates."}},deadIcon:{container:"btn-warning",active:"active",status:{title:"Stream",text:"Stream is waiting for data updates."}}},t.vars={getStream:{consoleBtn:!1,btnText:{title:"Update Data",text:"Update the JSON object."},modal:{title:"Update Data",text:"Update the current JSON object."},spinner:t.spinner.deadIcon},searchStream:{consoleBtn:!1,btnText:{title:"Add Data",text:"Insert new data in the type."},modal:{title:"Add Data",text:"Insert new data in the query type and see realtime matches via stream."},spinner:t.spinner.deadIcon}},hljs.initHighlighting();var e=$(window).height()-114-60;$(".tutorial-main-container").css({"min-height":e}),$('[data-toggle="popover"]').mouseover(function(){$(this).popover("show")}),$('[data-toggle="popover"]').mouseleave(function(){$(this).popover("hide")}),t.updateStep=!1,t.step_change(1)},t.init=function(){console.log("Tutorial is waiting for element"),$(".tutorial-container").length?t.initialize_var():n(t.init,500)},t.init(),t.app_submit=function(e){var a=13==e.keyCode||13==e.which;a&&($(".tutorial-app-name-container .loading-container").show(),o.createApp(t.variables.app_name).success(function(e){"App Created"==e.message?(t.variables.created_app.user=e.body.username,t.variables.created_app.pass=e.body.password,t.variables.created_app.name=t.variables.app_name,setTimeout(function(){hljs.initHighlighting.called=!1,hljs.initHighlighting(),$(".tutorial-app-name-container").addClass("disabled"),$(".tutorial-part-input").attr("readonly","true"),t.step_change(2),$(".tutorial-app-name-container .loading-container").hide(),t.popover()},500)):(alert("Please try again"),$(".tutorial-app-name-container .loading-container").hide())}).error(function(e){alert("An app with the same name exists"),$(".tutorial-app-name-container .loading-container").hide()}))};$(".code-block .nav li");t.code_next=function(e,a){switch(t.step_change(a),a){case 4:o.step1(t.variables.created_app).success(function(e){t.show_response(4,e)});break;case 5:o.step2.get(t.variables.created_app).on("data",function(e){n(function(){t.vars.getStream.consoleBtn=!0,t.readDocument=e},0),s(e,5),o.step2.stream(t.variables.created_app).on("data",function(e){n(function(){t.vars.getStream.spinner=t.spinner.activeIcon,t.readDocument=e},0),s(e,5)}).on("error",function(e){p(e,5)})}).on("error",function(e){p(e,5)});break;case 6:o.step3.get(t.variables.created_app).on("data",function(e){n(function(){t.vars.searchStream.consoleBtn=!0},0),s(e,6),o.step3.stream(t.variables.created_app).on("data",function(e){n(function(){t.vars.searchStream.spinner=t.spinner.activeIcon},0),s(e,6)}).on("error",function(e){p(e,6)})}).on("error",function(e){p(e,6)})}},t.change_tab=function(){t.current_step=1,t.show_response("",!0)},t.setCurrentState=function(e){n(function(){t.current_step=e,2==t.current_step?t.current_caption="Update":t.current_caption="Insert"},0)},t.show_response=function(a,r,i,o){var s=a-2,p=$(".tutorial-container .tutorial-part:eq("+s+")"),c=p.find(".show_response");if(i)c.html('<h3 class="text-center">'+r+"</h3>");else{t.show_response_data=r;var l=$("<div>").addClass("highlight-response").html("&nbsp\n"+JSON.stringify(t.show_response_data,null,4));o?(c.find(".highlight-response").removeClass("highlight-response"),c.append(l)):c.html(l),hljs.initHighlighting.called=!1,hljs.initHighlighting(),t.popover()}if($(".console-block .loading-container").hide(),t.updateStep)n(function(){t.updateStep=!1},2e3);else try{var u=p.find(".console-block").offset().top;$("html, body").animate({scrollTop:u},"fast")}catch(d){console.log(e)}setTimeout(function(){var e=p.find(".console-block").find(".highlight-response");if(e.length){var t=e.offset().top;p.find(".console-block").find("pre").animate({scrollTop:t},"fast")}},300)},t.language_change=function(){t.step_change(3)},t.popover=function(){for(var e in t.variables.created_app)$(".created_app_"+e).popover({content:t.variables.created_app[e],trigger:"hover",html:!0,placement:"top"})},t.step_change=function(e){n(function(){t.activeState=e},0),$(".tutorial-container").attr("data-current-step",e);for(var a=0;a<e;a++)$(".tutorial-container .tutorial-part:eq("+a+")").css({"max-height":"2000px",padding:"10px",overflow:"inherit",opacity:1});if(4!=e&&5!=e){var r=e-1,i=$(".tutorial-container .tutorial-part:eq("+r+")").offset().top-80;$("html, body").animate({scrollTop:i},"fast")}},t.insert_data={show:function(e){t.current_caption=e,t.current_modal="Update"==t.current_caption?t.vars.getStream.modal:t.vars.searchStream.modal;new BootstrapDialog({title:'<i class="fa fa-rotate-right"></i> '+t.current_modal.title,message:'<p class="explain-text">'+t.current_modal.text+'</p><textarea class="insert_text" id="insert-text"></textarea>',closable:!0,cssClass:"confirm-del insert_data_modal modal-appbase modal-blue",buttons:[{label:"Submit",cssClass:"btn-yes modal-btn",action:function(e){t.insert_data.user_input=t.editor.getValue();try{if(JSON.parse(t.insert_data.user_input)){if(t.insert_data.user_input=JSON.parse(t.insert_data.user_input),"Update"==t.current_caption)var a={credentials:t.variables.created_app,userInput:{type:t.variables.created_app.type,id:t.variables.created_app.id,body:t.insert_data.user_input}};else var a={credentials:t.variables.created_app,userInput:{type:t.variables.created_app.type,body:t.insert_data.user_input}};t.updateStep=!0,o.insertData(a).on("data",function(t){e.close()})}else alert("Invalid JSON Object.")}catch(r){console.log(r),alert("Invalid JSON Object.")}}}],onshown:function(e){if("Update"==t.current_caption)var a=JSON.stringify(t.readDocument._source,null,4);else var a=JSON.stringify(t.variables.created_app.purejson,null,4);user_object2=a.replace(/<br.*?>/g,"\n");var r={lineNumbers:!0,mode:"javascript",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,tabSize:2,extraKeys:{"Ctrl-Q":function(e){e.foldCode(e.getCursor())}},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]};t.editor=CodeMirror.fromTextArea(document.getElementById("insert-text"),r),t.editor.setValue(user_object2)}}).open()}},t.copy=function(){var e=window.getSelection().toString()+"",a={$app:'"'+t.variables.created_app.name+'"',$user:t.variables.created_app.user,$pass:t.variables.created_app.pass,$type:'"'+t.variables.created_app.type+'"',$id:t.variables.created_app.id,$jsonobject:JSON.stringify(t.variables.created_app.purejson,null,4)},r=e.replace(/\$app|\$user|\$pass|\$type|\$id|\$jsonobject/gi,function(e){return a[e]});$("#onlyCopy").val(r).select(),document.execCommand("copy")}}!function(){angular.module("Appbase",[]).config(["$httpProvider",function(e){e.defaults.withCredentials=!0}])}(),angular.module("Appbase").service("TutorialService",["$http",TutorialService]).factory("Loader",["$rootScope","$timeout",Loader]);var tutorial_adrs="https://accapi.appbase.io/";angular.module("Appbase").controller("TutorialController",TutorialController),TutorialController.$inject=["$scope","$http","$location","$timeout","Loader","TutorialService"];